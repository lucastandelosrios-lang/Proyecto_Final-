<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mi Nueva P√°gina</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(120deg, #e3f2fd 0%, #fffde7 100%);
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 800px;
            margin: 40px auto;
            background: #fff;
            box-shadow: 0 4px 24px rgba(33, 150, 243, 0.12);
            border-radius: 18px;
            padding: 40px 32px;
            border-top: 8px solid #ffb300;
        }
        h1 {
            color: #1565c0;
            text-align: center;
            margin-bottom: 32px;
            font-size: 2.4em;
            letter-spacing: 2px;
        }
        p {
            color: #333;
            font-size: 1.2em;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Bienvenido a la nueva p√°gina</h1>
        <p>Este es el contenido inicial. Puedes editarlo y agregar lo que desees.</p>
    </div>
df = load_data()
    </body>
</html>
# -------------------
st.sidebar.header("Filtros")

seccional = st.sidebar.selectbox("Seccional", options=["Todos"] + sorted(df["SECCIONAL"].dropna().unique().tolist()))
dependencia = st.sidebar.selectbox("Dependencia Padre", options=["Todos"] + sorted(df["DEPENDENCIA PADRE"].dropna().unique().tolist()))
responsable = st.sidebar.selectbox("Responsable", options=["Todos"] + sorted(df["NOMBRE RESPESPONSABLE"].dropna().unique().tolist()))
nro_proceso = st.sidebar.selectbox("Nro Proceso", options=["Todos"] + sorted(df["NRO PROCESO"].dropna().unique().tolist()))

# Correo para enviar alertas
st.sidebar.header("‚ö†Ô∏è Configuraci√≥n de Alertas")
email_destino = st.sidebar.text_input("Correo destino", "tu_correo@dominio.com")

# Aplicar filtros
df_filtered = df.copy()
if seccional != "Todos":
    df_filtered = df_filtered[df_filtered["SECCIONAL"] == seccional]
if dependencia != "Todos":
    df_filtered = df_filtered[df_filtered["DEPENDENCIA PADRE"] == dependencia]
if responsable != "Todos":
    df_filtered = df_filtered[df_filtered["NOMBRE RESPESPONSABLE"] == responsable]
if nro_proceso != "Todos":
    df_filtered = df_filtered[df_filtered["NRO PROCESO"] == nro_proceso]

# -------------------
# KPIs principales
# -------------------
total = len(df_filtered)
alerta = len(df_filtered[df_filtered["TIEMPO_CUSTODIA(DIAS)"] > 180])

col1, col2 = st.columns(2)
col1.metric("Veh√≠culos totales", total)
col2.metric("Veh√≠culos con alerta (>180 d√≠as)", alerta)

# -------------------
# Tabla de detalles
# -------------------
st.subheader("üìã Detalle de veh√≠culos con alerta (>180 d√≠as)")

df_alerta = df_filtered[df_filtered["TIEMPO_CUSTODIA(DIAS)"] > 180].copy()
df_alerta = df_alerta[[
    "SECCIONAL", "DEPENDENCIA PADRE", "NOMBRE RESPESPONSABLE",
    "NRO PROCESO", "PLACA SIAF", "FECHA ENTRADA", "TIEMPO_CUSTODIA(DIAS)"
]]

st.dataframe(df_alerta)

# -------------------
# Gr√°fico de distribuci√≥n
# -------------------
st.subheader("üìä Distribuci√≥n de tiempos en custodia")

fig, ax = plt.subplots(figsize=(8,5))
df_filtered["TIEMPO_CUSTODIA(DIAS)"].dropna().hist(bins=40, ax=ax, color="skyblue", edgecolor="black")
ax.axvline(180, color="red", linestyle="--", label="180 d√≠as (Alerta)")
ax.set_xlabel("D√≠as en custodia")
ax.set_ylabel("Cantidad de veh√≠culos")
ax.legend()
st.pyplot(fig)

# -------------------
# Env√≠o de alertas por correo
# -------------------
def enviar_alerta(destinatario, df_alerta):
    if len(df_alerta) == 0:
        return "No hay veh√≠culos con m√°s de 180 d√≠as."

    remitente = EMAIL_USER
    password = EMAIL_PASS

    asunto = "Alerta de  Custodia de Veh√≠culos (>180 d√≠as)"
     cuerpo = "Se detectaron los siguientes veh√≠culos en custodia con m√°s de 180 d√≠as:\n\n"
    cuerpo += df_alerta.to_string(index=False)

    msg = MIMEMultipart()
    msg["From"] = remitente
    msg["To"] = destinatario
    msg["Subject"] = asunto
    msg.attach(MIMEText(cuerpo, "plain"))

    try:
        with smtplib.SMTP(SMTP_SERVER, SMTP_PORT) as server:
            server.starttls()
            server.login(remitente, password)
            server.send_message(msg)
        return f"‚úÖ Correo enviado a {destinatario}"
    except Exception as e:
        return f"‚ùå Error enviando correo: {e}"

if st.sidebar.button("üì® Enviar alerta por correo"):
    resultado = enviar_alerta(email_destino, df_alerta)
    st.sidebar.success(resultado)
    EMAIL_USER=tu_usuario@gmail.com
EMAIL_PASS=tu_contrase√±a_app
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587

streamlit run dashboard_custodia.py

